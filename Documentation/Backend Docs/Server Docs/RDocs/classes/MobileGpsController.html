<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: MobileGpsController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">MobileGpsController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/mobile_gps_controller_rb.html">
                app/controllers/mobile_gps_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000320">create</a>&nbsp;&nbsp;
      <a href="#M000323">destroy</a>&nbsp;&nbsp;
      <a href="#M000322">destroy_temp</a>&nbsp;&nbsp;
      <a href="#M000319">edit</a>&nbsp;&nbsp;
      <a href="#M000314">get_avg_speed_for_udid_wrapper</a>&nbsp;&nbsp;
      <a href="#M000315">get_avg_speed_of_location</a>&nbsp;&nbsp;
      <a href="#M000312">get_avg_speed_of_location_box_wrapper</a>&nbsp;&nbsp;
      <a href="#M000299">get_avg_speed_table</a>&nbsp;&nbsp;
      <a href="#M000301">get_avg_speed_table_wrapper</a>&nbsp;&nbsp;
      <a href="#M000305">get_distance_between_GPS_coordinates</a>&nbsp;&nbsp;
      <a href="#M000298">get_max_speed_table</a>&nbsp;&nbsp;
      <a href="#M000300">get_max_speed_table_wrapper</a>&nbsp;&nbsp;
      <a href="#M000304">get_total_distance_of_user</a>&nbsp;&nbsp;
      <a href="#M000303">get_total_distance_table</a>&nbsp;&nbsp;
      <a href="#M000302">get_total_distance_table_wrapper</a>&nbsp;&nbsp;
      <a href="#M000311">get_user_rank_in_avg_speed</a>&nbsp;&nbsp;
      <a href="#M000310">get_user_rank_in_avg_speed_wrapper</a>&nbsp;&nbsp;
      <a href="#M000307">get_user_rank_in_max_speed</a>&nbsp;&nbsp;
      <a href="#M000306">get_user_rank_in_max_speed_wrapper</a>&nbsp;&nbsp;
      <a href="#M000309">get_user_rank_in_total_distance</a>&nbsp;&nbsp;
      <a href="#M000308">get_user_rank_in_total_distance_wrapper</a>&nbsp;&nbsp;
      <a href="#M000316">index</a>&nbsp;&nbsp;
      <a href="#M000297">is_udid_valid</a>&nbsp;&nbsp;
      <a href="#M000318">new</a>&nbsp;&nbsp;
      <a href="#M000296">sanitize</a>&nbsp;&nbsp;
      <a href="#M000317">show</a>&nbsp;&nbsp;
      <a href="#M000321">update</a>&nbsp;&nbsp;
      <a href="#M000313">vincenty_distance</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000314" class="method-detail">
        <a name="M000314"></a>

        <div class="method-heading">
          <a href="#M000314" class="method-signature">
          <span class="method-name">get_avg_speed_for_udid_wrapper</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the average of speeds which occurred within a box around a
particular gps coordinate. If no entries are in the box, then use the most
recent entry for the user who drove past here.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000314-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000314-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_avg_speed_for_udid_wrapper</span>(<span class="ruby-identifier">params</span>)
292:     <span class="ruby-identifier">udid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;udid&quot;</span>]
293:     <span class="ruby-identifier">lastResult</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value str">&quot;iphone_time DESC&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-value str">&quot;udid, latitude, longitude, speed&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value str">&quot;udid = ?&quot;</span>, <span class="ruby-identifier">udid</span>)
294: 
295:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lastResult</span>.<span class="ruby-identifier">exists?</span>
296:       <span class="ruby-identifier">lastResult</span> = <span class="ruby-identifier">lastResult</span>.<span class="ruby-identifier">first</span>
297:       <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">get_avg_speed_of_location</span>(<span class="ruby-identifier">lastResult</span>[<span class="ruby-identifier">:latitude</span>], <span class="ruby-identifier">lastResult</span>[<span class="ruby-identifier">:longitude</span>])
298:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exists?</span>
299:         <span class="ruby-identifier">ret</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">:current_speed</span>] = <span class="ruby-identifier">lastResult</span>[<span class="ruby-identifier">:speed</span>]
300:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ret</span>
301:       <span class="ruby-keyword kw">else</span>
302:         <span class="ruby-comment cmt">#If there are no points in the box, use the most recent mobile gps entry we have to average.</span>
303:         <span class="ruby-identifier">result</span> = []
304:         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:avg_speed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lastResult</span>[<span class="ruby-identifier">:speed</span>], <span class="ruby-identifier">:count</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:max_speed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lastResult</span>[<span class="ruby-identifier">:speed</span>], <span class="ruby-identifier">:max_speed_udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">udid</span>, <span class="ruby-identifier">:max_speed_user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ProfileName</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value str">&quot;udid = ?&quot;</span>, <span class="ruby-identifier">udid</span>).<span class="ruby-identifier">first</span>[<span class="ruby-identifier">:user_name</span>], <span class="ruby-identifier">:current_speed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lastResult</span>[<span class="ruby-identifier">:speed</span>]})
305:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
306:       <span class="ruby-keyword kw">end</span>
307:     <span class="ruby-keyword kw">end</span>
308:     <span class="ruby-keyword kw">return</span> [{}]
309:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000315" class="method-detail">
        <a name="M000315"></a>

        <div class="method-heading">
          <a href="#M000315" class="method-signature">
          <span class="method-name">get_avg_speed_of_location</span><span class="method-args">(latitude, longitude)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the average of speeds which occurred within a box around a
particular gps coordinate. Uses the Vincenty distance to measure the
distance between two coordinates. Throws out negative speed when computing
average as these are invalid readings.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000315-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000315-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 312</span>
312:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_avg_speed_of_location</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>)
313: 
314:     <span class="ruby-comment cmt">#query = MobileGps.all(:limit =&gt; 10, :conditions =&gt; &quot;speed &gt; 0.0&quot;, :select =&gt; 'speed, udid', :order =&gt; &quot;(latitude - &quot; + latitude.to_s + &quot;)*(latitude- &quot; + latitude.to_s + &quot;) + (longitude - &quot; + longitude.to_s + &quot;)*(longitude - &quot; + longitude.to_s + &quot;)&quot;)</span>
315: 
316:     <span class="ruby-identifier">avg_speed</span> = <span class="ruby-value">0</span>
317:     <span class="ruby-identifier">max_speed</span> = <span class="ruby-value">0</span>
318:     <span class="ruby-identifier">max_speed_udid</span> = <span class="ruby-value str">&quot;&quot;</span>
319:     <span class="ruby-identifier">max_speed_user_name</span> = <span class="ruby-value str">&quot;&quot;</span>
320:     <span class="ruby-comment cmt">#tol = 0.00946969697</span>
321:     
322:     <span class="ruby-comment cmt">#raised tolerance to approximately 300ft x 300ft</span>
323:     <span class="ruby-identifier">tol</span> = <span class="ruby-value">0</span><span class="ruby-value">.028</span>
324:     <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
325: 
326:     <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">find_each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
327:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">vincenty_distance</span>(<span class="ruby-identifier">latitude</span>,<span class="ruby-identifier">longitude</span>,<span class="ruby-identifier">q</span>[<span class="ruby-identifier">:latitude</span>],<span class="ruby-identifier">q</span>[<span class="ruby-identifier">:longitude</span>]) <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">tol</span>
328:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">q</span>[<span class="ruby-identifier">:speed</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_speed</span>
329:           <span class="ruby-identifier">max_speed</span> = <span class="ruby-identifier">q</span>[<span class="ruby-identifier">:speed</span>]
330:           <span class="ruby-identifier">max_speed_udid</span> = <span class="ruby-identifier">q</span>[<span class="ruby-identifier">:udid</span>]
331:         <span class="ruby-keyword kw">end</span>
332:         <span class="ruby-comment cmt">#Do not include negatives.</span>
333:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">q</span>[<span class="ruby-identifier">:speed</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
334:           <span class="ruby-identifier">avg_speed</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q</span>[<span class="ruby-identifier">:speed</span>]
335:           <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
336:         <span class="ruby-keyword kw">end</span>
337:       <span class="ruby-keyword kw">end</span>
338:     <span class="ruby-keyword kw">end</span>
339: 
340:     <span class="ruby-ivar">@result</span> = []
341:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ProfileName</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_speed_udid</span>).<span class="ruby-identifier">exists?</span>
342:       <span class="ruby-identifier">max_speed_user_name</span> = <span class="ruby-constant">ProfileName</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_speed_udid</span>).<span class="ruby-identifier">first</span>[<span class="ruby-identifier">:user_name</span>]
343:     <span class="ruby-keyword kw">end</span>
344:  
345:     <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:avg_speed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">avg_speed</span>, <span class="ruby-identifier">:count</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>, <span class="ruby-identifier">:max_speed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_speed</span>, <span class="ruby-identifier">:max_speed_udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_speed_udid</span>, <span class="ruby-identifier">:max_speed_user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max_speed_user_name</span>})
346:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@result</span>
347:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000312" class="method-detail">
        <a name="M000312"></a>

        <div class="method-heading">
          <a href="#M000312" class="method-signature">
          <span class="method-name">get_avg_speed_of_location_box_wrapper</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the average speed in a box around a particular gps coordinate.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000312-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000312-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 211</span>
211:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_avg_speed_of_location_box_wrapper</span>(<span class="ruby-identifier">params</span>)
212:     <span class="ruby-identifier">latitude</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;latitude&quot;</span>])
213:     <span class="ruby-identifier">longitude</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;longitude&quot;</span>])
214:     <span class="ruby-identifier">get_avg_speed_of_location</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>)
215:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000313" class="method-detail">
        <a name="M000313"></a>

        <div class="method-heading">
          <a href="#M000313" class="method-signature">
          <span class="method-name">vincenty_distance</span><span class="method-args">(lat1, long1, lat2, long2)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Just shoving Vincenty Distance here for now. TODO: leverage off geodesic
library.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000313-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000313-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 218</span>
218:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vincenty_distance</span>(<span class="ruby-identifier">lat1</span>, <span class="ruby-identifier">long1</span>, <span class="ruby-identifier">lat2</span>, <span class="ruby-identifier">long2</span>)
219:       <span class="ruby-identifier">pi</span> = <span class="ruby-value">3.14159265358979</span>
220:       <span class="ruby-identifier">a</span> = <span class="ruby-value">6378137.0</span>
221:       <span class="ruby-identifier">b</span> = <span class="ruby-value">6356752.314</span>
222:       <span class="ruby-identifier">f</span> = (<span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">b</span>)<span class="ruby-operator">/</span><span class="ruby-identifier">a</span>
223:       <span class="ruby-identifier">phi_1</span> = <span class="ruby-identifier">lat1</span>
224:       <span class="ruby-identifier">phi_2</span> = <span class="ruby-identifier">lat2</span>
225:       <span class="ruby-identifier">l</span> = (<span class="ruby-identifier">long2</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">long1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">pi</span> <span class="ruby-operator">/</span> <span class="ruby-value">180</span>
226:       <span class="ruby-identifier">u_1</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">atan</span>((<span class="ruby-value">1</span><span class="ruby-operator">-</span><span class="ruby-identifier">f</span>)<span class="ruby-operator">*</span><span class="ruby-constant">Math</span>.<span class="ruby-identifier">tan</span>(<span class="ruby-identifier">phi_1</span><span class="ruby-operator">*</span><span class="ruby-identifier">pi</span><span class="ruby-operator">/</span><span class="ruby-value">180</span>))
227:       <span class="ruby-identifier">u_2</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">atan</span>((<span class="ruby-value">1</span><span class="ruby-operator">-</span><span class="ruby-identifier">f</span>)<span class="ruby-operator">*</span><span class="ruby-constant">Math</span>.<span class="ruby-identifier">tan</span>(<span class="ruby-identifier">phi_2</span><span class="ruby-operator">*</span><span class="ruby-identifier">pi</span><span class="ruby-operator">/</span><span class="ruby-value">180</span>))
228:       <span class="ruby-identifier">sin_U1</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sin</span>(<span class="ruby-identifier">u_1</span>)
229:       <span class="ruby-identifier">cos_U1</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">cos</span>(<span class="ruby-identifier">u_1</span>)
230:       <span class="ruby-identifier">sin_U2</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sin</span>(<span class="ruby-identifier">u_2</span>)
231:       <span class="ruby-identifier">cos_U2</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">cos</span>(<span class="ruby-identifier">u_2</span>)
232:       <span class="ruby-identifier">lam</span> = <span class="ruby-identifier">l</span>
233:       <span class="ruby-identifier">lam_prev</span> = <span class="ruby-value">0</span>
234:       <span class="ruby-identifier">iter_limit</span> = <span class="ruby-value">100</span>
235:       <span class="ruby-identifier">tol</span> = <span class="ruby-value">1e-12</span>
236: 
237:       <span class="ruby-identifier">cos2_alpha</span> = <span class="ruby-value">0</span>
238:       <span class="ruby-identifier">sin_sig</span> = <span class="ruby-value">0</span>
239:       <span class="ruby-identifier">cos_sig</span> = <span class="ruby-value">0</span>
240:       <span class="ruby-identifier">cos_2sigma_m</span> = <span class="ruby-value">0</span>
241:       <span class="ruby-identifier">sigma</span> = <span class="ruby-value">0</span>
242: 
243:       <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
244:         <span class="ruby-identifier">sin_lam</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sin</span>(<span class="ruby-identifier">lam</span>)
245:         <span class="ruby-identifier">cos_lam</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">cos</span>(<span class="ruby-identifier">lam</span>)
246:         <span class="ruby-identifier">sin_sig</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>( (<span class="ruby-identifier">cos_U2</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_lam</span>) <span class="ruby-operator">*</span>
247:                              (<span class="ruby-identifier">cos_U2</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_lam</span>) <span class="ruby-operator">+</span> 
248:                              (<span class="ruby-identifier">cos_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_U2</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">sin_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_U2</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_lam</span>) <span class="ruby-operator">*</span>
249:                              (<span class="ruby-identifier">cos_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_U2</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">sin_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_U2</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_lam</span>)
250:                              )
251:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sin_sig</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
252:           <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>
253:         <span class="ruby-keyword kw">end</span>
254:         <span class="ruby-identifier">cos_sig</span> = <span class="ruby-identifier">sin_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_U2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cos_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_U2</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_lam</span>
255:         <span class="ruby-identifier">sigma</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">atan</span>( <span class="ruby-identifier">sin_sig</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">cos_sig</span> )
256:         <span class="ruby-identifier">sin_alpha</span> = <span class="ruby-identifier">cos_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_U2</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_lam</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">sin_sig</span>
257:         <span class="ruby-identifier">cos2_alpha</span> = <span class="ruby-value">1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">sin_alpha</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_alpha</span>
258:         <span class="ruby-identifier">cos_2sigma_m</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">cos_sig</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_U1</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_U2</span><span class="ruby-operator">/</span><span class="ruby-identifier">cos2_alpha</span>)
259:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cos_2sigma_m</span>.<span class="ruby-identifier">nan?</span>
260:           <span class="ruby-identifier">cos_2sigma_m</span> = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
261:         <span class="ruby-keyword kw">end</span>
262:         <span class="ruby-identifier">c</span> = <span class="ruby-identifier">f</span> <span class="ruby-operator">/</span> <span class="ruby-value">16</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cos2_alpha</span> <span class="ruby-operator">*</span> (<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span><span class="ruby-operator">*</span>(<span class="ruby-value">4</span> <span class="ruby-operator">-</span> <span class="ruby-value">3</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos2_alpha</span>))
263:         <span class="ruby-identifier">lam_prev</span> = <span class="ruby-identifier">lam</span>
264:         <span class="ruby-identifier">lam</span> = <span class="ruby-identifier">l</span> <span class="ruby-operator">+</span> (<span class="ruby-value">1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">f</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_alpha</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">sigma</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">sin_sig</span> <span class="ruby-operator">*</span> ( <span class="ruby-identifier">cos_2sigma_m</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cos_sig</span> <span class="ruby-operator">*</span> (<span class="ruby-value">-1</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_2sigma_m</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_2sigma_m</span>) ) )
265: 
266:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">lam</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lam_prev</span>).<span class="ruby-identifier">abs</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">tol</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">iter_limit</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
267:           <span class="ruby-keyword kw">break</span>
268:         <span class="ruby-keyword kw">end</span>
269:       
270:         <span class="ruby-identifier">iter_limit</span> = <span class="ruby-identifier">iter_limit</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
271: 
272:       <span class="ruby-keyword kw">end</span>
273: 
274:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">iter_limit</span> <span class="ruby-operator">==</span> <span class="ruby-value">100</span>
275:         <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span>
276:       <span class="ruby-keyword kw">end</span>
277: 
278:       <span class="ruby-identifier">u2</span> = <span class="ruby-identifier">cos2_alpha</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">a</span><span class="ruby-operator">*</span><span class="ruby-identifier">a</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span><span class="ruby-operator">*</span><span class="ruby-identifier">b</span>) <span class="ruby-operator">/</span> (<span class="ruby-identifier">b</span><span class="ruby-operator">*</span><span class="ruby-identifier">b</span>)
279:       <span class="ruby-identifier">a_</span> = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u2</span> <span class="ruby-operator">/</span> <span class="ruby-value">16384</span> <span class="ruby-operator">*</span> (<span class="ruby-value">4096</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u2</span> <span class="ruby-operator">*</span> (<span class="ruby-value">-768</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u2</span> <span class="ruby-operator">*</span> (<span class="ruby-value">320</span> <span class="ruby-operator">-</span> <span class="ruby-value">175</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">u2</span>) ) )
280:       <span class="ruby-identifier">b_</span> = <span class="ruby-identifier">u2</span> <span class="ruby-operator">/</span> <span class="ruby-value">1024</span> <span class="ruby-operator">*</span> (<span class="ruby-value">256</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u2</span> <span class="ruby-operator">*</span> (<span class="ruby-value">-128</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">u2</span> <span class="ruby-operator">*</span> (<span class="ruby-value">74</span> <span class="ruby-operator">-</span> <span class="ruby-value">47</span><span class="ruby-operator">*</span><span class="ruby-identifier">u2</span>) ) )
281:       <span class="ruby-identifier">dsigma</span> = <span class="ruby-identifier">b_</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">sin_sig</span> <span class="ruby-operator">*</span> ( <span class="ruby-identifier">cos_2sigma_m</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span><span class="ruby-operator">/</span><span class="ruby-value">4</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">b_</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">cos_sig</span><span class="ruby-operator">*</span>(<span class="ruby-value">-1</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cos_2sigma_m</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cos_2sigma_m</span>)  <span class="ruby-operator">-</span> <span class="ruby-value">1</span><span class="ruby-operator">/</span><span class="ruby-value">6</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">b_</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cos_2sigma_m</span> <span class="ruby-operator">*</span> (<span class="ruby-value">-3</span> <span class="ruby-operator">+</span> <span class="ruby-value">4</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">sin_sig</span><span class="ruby-operator">*</span><span class="ruby-identifier">sin_sig</span>) <span class="ruby-operator">*</span> (<span class="ruby-value">-3</span> <span class="ruby-operator">+</span> <span class="ruby-value">4</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_2sigma_m</span><span class="ruby-operator">*</span><span class="ruby-identifier">cos_2sigma_m</span> ) ) )
282:       <span class="ruby-identifier">s</span> = <span class="ruby-identifier">b</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">a_</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">sigma</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">dsigma</span>)
283: 
284:       <span class="ruby-comment cmt"># convert meters to miles</span>
285:       <span class="ruby-identifier">s</span> <span class="ruby-operator">*=</span> <span class="ruby-value">0</span><span class="ruby-value">.000621371192</span>
286: 
287:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">s</span>
288:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000320" class="method-detail">
        <a name="M000320"></a>

        <div class="method-heading">
          <a href="#M000320" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
POST /mobile_gps POST /mobile_gps.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000320-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000320-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 389</span>
389:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
390:   
391:     <span class="ruby-identifier">time_before</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
392:     <span class="ruby-identifier">j</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:data</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'\\'</span>,<span class="ruby-value str">''</span>))
393: 
394:     <span class="ruby-ivar">@mobile_gps</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">new</span>
395: 
396:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">udid</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;udid&quot;</span>]
397:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">iphone_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;iphone_time&quot;</span>].<span class="ruby-identifier">to_f</span>)
398:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">latitude</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;latitude&quot;</span>].<span class="ruby-identifier">to_f</span>
399:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">longitude</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;longitude&quot;</span>].<span class="ruby-identifier">to_f</span>
400:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">altitude</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;altitude&quot;</span>].<span class="ruby-identifier">to_f</span>
401:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">course</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;course&quot;</span>].<span class="ruby-identifier">to_f</span>
402:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">horz_acc</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;horz_acc&quot;</span>].<span class="ruby-identifier">to_f</span>
403:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">vert_acc</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;vert_acc&quot;</span>].<span class="ruby-identifier">to_f</span>
404:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">speed</span> = <span class="ruby-identifier">j</span>[<span class="ruby-value str">&quot;speed&quot;</span>].<span class="ruby-identifier">to_f</span>
405: 
406:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">save</span>
407:     
408:     <span class="ruby-identifier">time_after</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
409:     <span class="ruby-identifier">output</span> = <span class="ruby-constant">UnlockedAchievement</span>.<span class="ruby-identifier">get_user_achievements_within_range</span>(<span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">udid</span>, <span class="ruby-identifier">time_before</span>, <span class="ruby-identifier">time_after</span>)
410:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">output</span>
411: 
412:     <span class="ruby-comment cmt">#respond_to do |format|</span>
413:     <span class="ruby-comment cmt">#  if @mobile_gps.save</span>
414:     <span class="ruby-comment cmt">#    format.html { redirect_to(@mobile_gps, :notice =&gt; 'Mobile gps was successfully created.') }</span>
415:     <span class="ruby-comment cmt">#    format.xml  { render :xml =&gt; @mobile_gps, :status =&gt; :created, :location =&gt; @mobile_gps }</span>
416:     <span class="ruby-comment cmt">#  else</span>
417:     <span class="ruby-comment cmt">#    format.html { render :action =&gt; &quot;new&quot; }x</span>
418:     <span class="ruby-comment cmt">#    format.xml  { render :xml =&gt; @mobile_gps.errors, :status =&gt; :unprocessable_entity }</span>
419:     <span class="ruby-comment cmt">#  end</span>
420:     <span class="ruby-comment cmt">#end</span>
421:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000323" class="method-detail">
        <a name="M000323"></a>

        <div class="method-heading">
          <a href="#M000323" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
DELETE /mobile_gps/1 DELETE /mobile_gps/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000323-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000323-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 450</span>
450:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
451:     <span class="ruby-ivar">@mobile_gps</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
452:     <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">destroy</span>
453: 
454:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
455:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">mobile_gp_index_url</span>) }
456:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
457:     <span class="ruby-keyword kw">end</span>
458:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000322" class="method-detail">
        <a name="M000322"></a>

        <div class="method-heading">
          <a href="#M000322" class="method-signature">
          <span class="method-name">destroy_temp</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000322-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000322-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 440</span>
440:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_temp</span>
441:       <span class="ruby-identifier">udid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:udid</span>]
442:       <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">udid</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mobile_gp</span><span class="ruby-operator">|</span>
443:          <span class="ruby-identifier">mobile_gp</span>.<span class="ruby-identifier">destroy</span>
444:       <span class="ruby-keyword kw">end</span>
445:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;[DEBUG] done with destroy_temp&quot;</span>
446:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000319" class="method-detail">
        <a name="M000319"></a>

        <div class="method-heading">
          <a href="#M000319" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /mobile_gps/1/edit
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000319-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000319-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 383</span>
383:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
384:     <span class="ruby-ivar">@mobile_gps</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
385:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000299" class="method-detail">
        <a name="M000299"></a>

        <div class="method-heading">
          <a href="#M000299" class="method-signature">
          <span class="method-name">get_avg_speed_table</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000299-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000299-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 48</span>
48:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_avg_speed_table</span>
49:     <span class="ruby-identifier">table</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:speed</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'speed &gt;= 0'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:udid</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'average_speed DESC'</span>)
50:     <span class="ruby-ivar">@table_in_miles</span> = []
51:     <span class="ruby-identifier">table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
52:       <span class="ruby-identifier">mph</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>])
53:       <span class="ruby-ivar">@table_in_miles</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mph</span>})
54:     <span class="ruby-keyword kw">end</span>
55:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@table_in_miles</span>
56:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000301" class="method-detail">
        <a name="M000301"></a>

        <div class="method-heading">
          <a href="#M000301" class="method-signature">
          <span class="method-name">get_avg_speed_table_wrapper</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000301-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000301-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 70</span>
70:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_avg_speed_table_wrapper</span>
71:     <span class="ruby-ivar">@leaderboard</span> = []
72:     <span class="ruby-identifier">i</span> = <span class="ruby-value">1</span>
73:     <span class="ruby-identifier">get_avg_speed_table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">velocity</span><span class="ruby-operator">|</span>
74:       <span class="ruby-ivar">@leaderboard</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:rank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">velocity</span>[<span class="ruby-identifier">:udid</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Float</span>(<span class="ruby-identifier">velocity</span>[<span class="ruby-identifier">:payload</span>])})
75:       <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-value">+1</span>
76:     <span class="ruby-keyword kw">end</span>
77:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@leaderboard</span>
78: 
79:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000305" class="method-detail">
        <a name="M000305"></a>

        <div class="method-heading">
          <a href="#M000305" class="method-signature">
          <span class="method-name">get_distance_between_GPS_coordinates</span><span class="method-args">(lat1, long1, lat2, long2)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000305-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000305-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_distance_between_GPS_coordinates</span>(<span class="ruby-identifier">lat1</span>, <span class="ruby-identifier">long1</span>, <span class="ruby-identifier">lat2</span>, <span class="ruby-identifier">long2</span>)
119:     <span class="ruby-identifier">gps_to_miles_scale</span> = <span class="ruby-value">68.1818</span> <span class="ruby-comment cmt">#miles per gps coordinate</span>
120:     
121:     <span class="ruby-identifier">lat_dist</span> = <span class="ruby-identifier">lat1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lat2</span>
122:     <span class="ruby-identifier">long_dist</span> = <span class="ruby-identifier">long1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">long2</span>
123:     <span class="ruby-identifier">distance</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">lat_dist</span><span class="ruby-operator">*</span><span class="ruby-identifier">lat_dist</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">long_dist</span><span class="ruby-operator">*</span><span class="ruby-identifier">long_dist</span>)
124:     <span class="ruby-identifier">distance</span> = <span class="ruby-identifier">distance</span><span class="ruby-operator">*</span><span class="ruby-identifier">gps_to_miles_scale</span>
125:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000298" class="method-detail">
        <a name="M000298"></a>

        <div class="method-heading">
          <a href="#M000298" class="method-signature">
          <span class="method-name">get_max_speed_table</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000298-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000298-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 35</span>
35:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_max_speed_table</span>
36:     
37:     <span class="ruby-identifier">table</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:speed</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'speed &gt;= 0'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:udid</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'maximum_speed DESC'</span>)
38:     
39:     <span class="ruby-ivar">@table_in_miles</span> = []
40:     <span class="ruby-identifier">table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
41:       <span class="ruby-identifier">mph</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>])
42:       <span class="ruby-ivar">@table_in_miles</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mph</span>})
43:     <span class="ruby-keyword kw">end</span>
44:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@table_in_miles</span>
45:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000300" class="method-detail">
        <a name="M000300"></a>

        <div class="method-heading">
          <a href="#M000300" class="method-signature">
          <span class="method-name">get_max_speed_table_wrapper</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000300-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000300-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 59</span>
59:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_max_speed_table_wrapper</span>
60:     <span class="ruby-ivar">@leaderboard</span> = []
61:     <span class="ruby-identifier">i</span> = <span class="ruby-value">1</span>
62:     <span class="ruby-identifier">get_max_speed_table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">velocity</span><span class="ruby-operator">|</span>
63:       <span class="ruby-ivar">@leaderboard</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:rank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">velocity</span>[<span class="ruby-identifier">:udid</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Float</span>(<span class="ruby-identifier">velocity</span>[<span class="ruby-identifier">:payload</span>])})
64:       <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> 
65:     <span class="ruby-keyword kw">end</span>
66:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@leaderboard</span>
67:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000304" class="method-detail">
        <a name="M000304"></a>

        <div class="method-heading">
          <a href="#M000304" class="method-signature">
          <span class="method-name">get_total_distance_of_user</span><span class="method-args">(user_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000304-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000304-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 98</span>
 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_total_distance_of_user</span>(<span class="ruby-identifier">user_id</span>)
 99:     <span class="ruby-identifier">user_locations</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value str">&quot;udid = ?&quot;</span>,<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value str">&quot;iphone_time ASC&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-value str">&quot;udid, latitude, longitude, iphone_time&quot;</span>)
100:     
101:     <span class="ruby-identifier">total_distance</span> = <span class="ruby-value">0</span>
102:     <span class="ruby-identifier">lat1</span>, <span class="ruby-identifier">long1</span>, <span class="ruby-identifier">lat2</span>, <span class="ruby-identifier">long2</span> = <span class="ruby-value">0</span>
103:     <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
104:     <span class="ruby-identifier">user_locations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user_location</span><span class="ruby-operator">|</span>
105:       <span class="ruby-identifier">lat1</span> = <span class="ruby-identifier">lat2</span>
106:       <span class="ruby-identifier">long1</span> = <span class="ruby-identifier">long2</span>
107:       <span class="ruby-identifier">lat2</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">user_location</span>[<span class="ruby-identifier">:latitude</span>])
108:       <span class="ruby-identifier">long2</span> = <span class="ruby-constant">Float</span>(<span class="ruby-identifier">user_location</span>[<span class="ruby-identifier">:longitude</span>])
109:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
110:         <span class="ruby-identifier">total_distance</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">get_distance_between_GPS_coordinates</span>(<span class="ruby-identifier">lat1</span>, <span class="ruby-identifier">long1</span>, <span class="ruby-identifier">lat2</span>, <span class="ruby-identifier">long2</span>)
111:       <span class="ruby-keyword kw">end</span>
112:       <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
113:     <span class="ruby-keyword kw">end</span>
114:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">total_distance</span>
115:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000303" class="method-detail">
        <a name="M000303"></a>

        <div class="method-heading">
          <a href="#M000303" class="method-signature">
          <span class="method-name">get_total_distance_table</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000303-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000303-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 88</span>
88:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_total_distance_table</span>
89:     <span class="ruby-ivar">@leaderboard</span> = []
90:     <span class="ruby-identifier">user_ids</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">group</span>(<span class="ruby-identifier">:udid</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">:udid</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user_id</span><span class="ruby-operator">|</span>
91:       <span class="ruby-identifier">total_distance</span> = <span class="ruby-identifier">get_total_distance_of_user</span>(<span class="ruby-identifier">user_id</span>[<span class="ruby-identifier">:udid</span>])
92:       <span class="ruby-ivar">@leaderboard</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_id</span>[<span class="ruby-identifier">:udid</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total_distance</span>})
93:     <span class="ruby-keyword kw">end</span>
94:     <span class="ruby-ivar">@leaderboard</span> = <span class="ruby-ivar">@leaderboard</span>.<span class="ruby-identifier">sort_by</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:payload</span>]}.<span class="ruby-identifier">reverse</span>
95:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000302" class="method-detail">
        <a name="M000302"></a>

        <div class="method-heading">
          <a href="#M000302" class="method-signature">
          <span class="method-name">get_total_distance_table_wrapper</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000302-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000302-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 82</span>
82:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_total_distance_table_wrapper</span>
83:     <span class="ruby-ivar">@leaderboards</span> = <span class="ruby-identifier">get_total_distance_table</span>
84:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@leaderboard</span>
85:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000311" class="method-detail">
        <a name="M000311"></a>

        <div class="method-heading">
          <a href="#M000311" class="method-signature">
          <span class="method-name">get_user_rank_in_avg_speed</span><span class="method-args">(user_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000311-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000311-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 189</span>
189:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_user_rank_in_avg_speed</span>(<span class="ruby-identifier">user_id</span>)
190:     <span class="ruby-ivar">@user_rank</span> = []
191:     <span class="ruby-identifier">avg_speed_table</span> = <span class="ruby-identifier">get_avg_speed_table</span>
192:     
193:     <span class="ruby-comment cmt">#extremely naive way of implementing rankfinding</span>
194:     <span class="ruby-comment cmt">#it just iterates through table until it finds user</span>
195:     <span class="ruby-comment cmt">#TODO: fix change this later!</span>
196:     <span class="ruby-identifier">i</span> = <span class="ruby-value">1</span>
197:     <span class="ruby-identifier">avg_speed_table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
198:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:udid</span>]
199:         <span class="ruby-ivar">@user_rank</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:rank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:udid</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Float</span>(<span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:payload</span>])})
200:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@user_rank</span>
201:       <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
203:     <span class="ruby-keyword kw">end</span>
204:     
205:     <span class="ruby-comment cmt">#what should it return if it doesn't find that user ID?</span>
206:     <span class="ruby-comment cmt">#currently just returns empty</span>
207:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@user_rank</span>
208:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000310" class="method-detail">
        <a name="M000310"></a>

        <div class="method-heading">
          <a href="#M000310" class="method-signature">
          <span class="method-name">get_user_rank_in_avg_speed_wrapper</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000310-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000310-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 182</span>
182:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_user_rank_in_avg_speed_wrapper</span>
183:     <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:udid</span>]
184:     <span class="ruby-ivar">@result</span> = <span class="ruby-identifier">get_user_rank_in_avg_speed</span>(<span class="ruby-identifier">user_id</span>)
185:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@result</span>
186:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000307" class="method-detail">
        <a name="M000307"></a>

        <div class="method-heading">
          <a href="#M000307" class="method-signature">
          <span class="method-name">get_user_rank_in_max_speed</span><span class="method-args">(user_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000307-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000307-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 135</span>
135:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_user_rank_in_max_speed</span>(<span class="ruby-identifier">user_id</span>)
136:     <span class="ruby-ivar">@user_rank</span> = []
137:     <span class="ruby-identifier">max_speed_table</span> = <span class="ruby-identifier">get_max_speed_table</span>
138:     
139:     <span class="ruby-comment cmt">#extremely naive way of implementing rankfinding</span>
140:     <span class="ruby-comment cmt">#it just iterates through table until it finds user</span>
141:     <span class="ruby-comment cmt">#TODO: fix change this later!</span>
142:     <span class="ruby-identifier">i</span> = <span class="ruby-value">1</span>
143:     <span class="ruby-identifier">max_speed_table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
144:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:udid</span>]
145:         <span class="ruby-ivar">@user_rank</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:rank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:udid</span>], <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Float</span>(<span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:payload</span>])})
146:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@user_rank</span>
147:       <span class="ruby-keyword kw">end</span>
148:       <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
149:     <span class="ruby-keyword kw">end</span>
150:     
151:     <span class="ruby-comment cmt">#what should it return if it doesn't find that user ID?</span>
152:     <span class="ruby-comment cmt">#currently just returns empty</span>
153:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@user_rank</span>
154:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000306" class="method-detail">
        <a name="M000306"></a>

        <div class="method-heading">
          <a href="#M000306" class="method-signature">
          <span class="method-name">get_user_rank_in_max_speed_wrapper</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000306-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000306-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 128</span>
128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_user_rank_in_max_speed_wrapper</span>
129:     <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:udid</span>]
130:     <span class="ruby-ivar">@result</span> = <span class="ruby-identifier">get_user_rank_in_max_speed</span>(<span class="ruby-identifier">user_id</span>)
131:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@result</span>
132:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000309" class="method-detail">
        <a name="M000309"></a>

        <div class="method-heading">
          <a href="#M000309" class="method-signature">
          <span class="method-name">get_user_rank_in_total_distance</span><span class="method-args">(user_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000309-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000309-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 164</span>
164:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_user_rank_in_total_distance</span>(<span class="ruby-identifier">user_id</span>)
165:     <span class="ruby-ivar">@user_rank</span> = []
166:     
167:     <span class="ruby-identifier">total_distance_table</span> = <span class="ruby-identifier">get_total_distance_table</span>
168:    
169:     <span class="ruby-identifier">i</span> = <span class="ruby-value">1</span>
170:     <span class="ruby-identifier">total_distance_table</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
171:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:udid</span>]
172:         <span class="ruby-ivar">@user_rank</span>.<span class="ruby-identifier">push</span>({<span class="ruby-identifier">:rank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>[<span class="ruby-identifier">:payload</span>]})
173:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@user_rank</span>
174:       <span class="ruby-keyword kw">end</span>
175:       <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
176:     <span class="ruby-keyword kw">end</span>
177:     
178:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@user_rank</span>
179:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000308" class="method-detail">
        <a name="M000308"></a>

        <div class="method-heading">
          <a href="#M000308" class="method-signature">
          <span class="method-name">get_user_rank_in_total_distance_wrapper</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Will be deprecated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000308-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000308-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_user_rank_in_total_distance_wrapper</span>
158:     <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:udid</span>]
159:     <span class="ruby-ivar">@result</span> = <span class="ruby-identifier">get_user_rank_in_total_distance</span>(<span class="ruby-identifier">user_id</span>)
160:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@result</span>
161:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000316" class="method-detail">
        <a name="M000316"></a>

        <div class="method-heading">
          <a href="#M000316" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /mobile_gps GET /mobile_gps.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000316-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000316-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 351</span>
351:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
352:     <span class="ruby-comment cmt">#@mobile_gps_table = MobileGps.all</span>
353: 
354:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
355:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># index.html.erb</span>
356:     <span class="ruby-comment cmt">#  format.xml  { render :xml =&gt; @mobile_gps }</span>
357:     <span class="ruby-keyword kw">end</span>
358:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000297" class="method-detail">
        <a name="M000297"></a>

        <div class="method-heading">
          <a href="#M000297" class="method-signature">
          <span class="method-name">is_udid_valid</span><span class="method-args">(udid)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Validation criteria for udid.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000297-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000297-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 25</span>
25:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_udid_valid</span>(<span class="ruby-identifier">udid</span>)
26:     <span class="ruby-identifier">num</span> = <span class="ruby-identifier">udid</span>.<span class="ruby-identifier">count</span> <span class="ruby-value str">&quot;-&quot;</span>
27:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">udid</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
28:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
29:     <span class="ruby-keyword kw">else</span>
30:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
31:     <span class="ruby-keyword kw">end</span>
32:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000318" class="method-detail">
        <a name="M000318"></a>

        <div class="method-heading">
          <a href="#M000318" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /mobile_gps/new GET /mobile_gps/new.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000318-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000318-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
374:     <span class="ruby-ivar">@mobile_gps</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">new</span>
375: 
376:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
377:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># new.html.erb</span>
378:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@mobile_gp</span> }
379:     <span class="ruby-keyword kw">end</span>
380:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000296" class="method-detail">
        <a name="M000296"></a>

        <div class="method-heading">
          <a href="#M000296" class="method-signature">
          <span class="method-name">sanitize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deletes all entries which do not meet validation criteria. Will migrate
functionality to active record validations.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000296-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000296-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 4</span>
 4:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sanitize</span>
 5:     <span class="ruby-identifier">user_ids</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">group</span>(<span class="ruby-identifier">:udid</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">:udid</span>)
 6:     <span class="ruby-identifier">array</span> = []
 7:     <span class="ruby-identifier">array</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value str">&quot;Sanity check&quot;</span>)
 8:     <span class="ruby-identifier">user_ids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
 9:       <span class="ruby-identifier">udid</span> = <span class="ruby-identifier">user</span>[<span class="ruby-identifier">:udid</span>]
10:       <span class="ruby-identifier">is_valid</span> = <span class="ruby-identifier">is_udid_valid</span>(<span class="ruby-identifier">udid</span>)
11:       <span class="ruby-identifier">array</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;udid #{udid}: #{is_valid}&quot;</span>)
12: 
13:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">is_valid</span>
14:         <span class="ruby-comment cmt">#delete all entries with this udid</span>
15:         <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">:udid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>[<span class="ruby-identifier">:udid</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
16:           <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">destroy</span>
17:         <span class="ruby-keyword kw">end</span>
18:       <span class="ruby-keyword kw">end</span>
19:     <span class="ruby-keyword kw">end</span>
20:     
21:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">array</span>
22:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000317" class="method-detail">
        <a name="M000317"></a>

        <div class="method-heading">
          <a href="#M000317" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /mobile_gps/1 GET /mobile_gps/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000317-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000317-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 362</span>
362:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
363:     <span class="ruby-ivar">@mobile_gps</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
364: 
365:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
366:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># show.html.erb</span>
367:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@mobile_gps</span> }
368:     <span class="ruby-keyword kw">end</span>
369:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000321" class="method-detail">
        <a name="M000321"></a>

        <div class="method-heading">
          <a href="#M000321" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
PUT /mobile_gps/1 PUT /mobile_gps/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000321-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000321-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/mobile_gps_controller.rb, line 425</span>
425:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
426:     <span class="ruby-ivar">@mobile_gps</span> = <span class="ruby-constant">MobileGps</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
427: 
428:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
429:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mobile_gps</span>])
430:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@mobile_gps</span>, <span class="ruby-identifier">:notice</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Mobile gps was successfully updated.'</span>) }
431:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">head</span> <span class="ruby-identifier">:ok</span> }
432:       <span class="ruby-keyword kw">else</span>
433:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit&quot;</span> }
434:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@mobile_gps</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:unprocessable_entity</span> }
435:       <span class="ruby-keyword kw">end</span>
436:     <span class="ruby-keyword kw">end</span>
437:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>